var t={};class e{static STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=e.STATUS.idle,this.fieldSize=t.length,this.initialState=t,this.score=0,this.state=t.map(t=>[...t])}getColumns(t){return t[0].map((e,s)=>t.map(t=>t[s]))}moveLeft(){if(this.status!==e.STATUS.playing)return;let t=this.state.map(t=>{let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);return[...e=e.filter(t=>0!==t),...Array(this.fieldSize-e.length).fill(0)]});this.state.every((e,s)=>e.every((e,i)=>e===t[s][i]))||(this.state=t,this.addNewCell(),this.setField(),this.getStatus())}moveRight(){if(this.status!==e.STATUS.playing)return;let t=this.state.map(t=>{let e=t.filter(t=>0!==t);for(let t=e.length-1;t>0;t--)e[t]===e[t-1]&&(e[t]*=2,e[t-1]=0,this.score+=e[t]);return e=e.filter(t=>0!==t),[...Array(this.fieldSize-e.length).fill(0),...e]});this.state.every((e,s)=>e.every((e,i)=>e===t[s][i]))||(this.state=t,this.addNewCell(),this.setField(),this.getStatus())}moveUp(){if(this.status!==e.STATUS.playing)return;let t=this.getColumns(this.state).map(t=>{let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);return[...e=e.filter(t=>0!==t),...Array(this.fieldSize-e.length).fill(0)]}),s=t[0].map((e,s)=>t.map(t=>t[s]));this.state.every((t,e)=>t.every((t,i)=>t===s[e][i]))||(this.state=s,this.addNewCell(),this.setField(),this.getStatus())}moveDown(){if(this.status!==e.STATUS.playing)return;let t=this.getColumns(this.state).map(t=>{let e=t.filter(t=>0!==t);for(let t=e.length-1;t>0;t--)e[t]===e[t-1]&&(e[t]*=2,e[t-1]=0,this.score+=e[t]);return e=e.filter(t=>0!==t),[...Array(this.fieldSize-e.length).fill(0),...e]}),s=t[0].map((e,s)=>t.map(t=>t[s]));this.state.every((t,e)=>t.every((t,i)=>t===s[e][i]))||(this.state=s,this.addNewCell(),this.setField(),this.getStatus())}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.STATUS.playing,this.state=this.initialState.map(t=>[...t]),this.addNewCell(),this.addNewCell(),this.setField(),this.score=0}restart(){this.status=e.STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.setField(),this.score=0}setField(){let t=document.querySelectorAll(".field-cell"),s=this.state.flat();for(let e=0;e<t.length;e++)t[e].className="field-cell",s[e]?(t[e].textContent=s[e],t[e].classList.add(`field-cell--${s[e]}`)):t[e].textContent="";for(let t of s)2048===t&&(this.status=e.STATUS.win);this.checkMovesAvailable()||(this.status=e.STATUS.lose)}checkMovesAvailable(){let t;let e=!this.state.flat().every(t=>0!==t);for(let e=0;e<this.fieldSize;e++)for(let s=0;s<this.fieldSize;s++)(s<this.fieldSize-1&&this.state[e][s]===this.state[e][s+1]||e<this.fieldSize-1&&this.state[e][s]===this.state[e+1][s])&&(t=!0);return!!e||!!t}addNewCell(){let t=[];for(let e=0;e<this.fieldSize;e++)for(let s=0;s<this.fieldSize;s++)0===this.state[e][s]&&t.push({row:e,col:s});if(0===t.length)return;let e=Math.floor(Math.random()*t.length),{row:s,col:i}=t[e],l=this.state.map(t=>[...t]);l[s][i]=Math.random()>.4?2:4,this.state=l}}const s=new(t=e),i=document.querySelector(".button"),l=document.querySelector(".game-score"),a=document.querySelector(".message-start"),r=document.querySelector(".message-lose"),h=document.querySelector(".message-win");function n(e){switch(e.preventDefault(),e.key){case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight()}l.textContent=s.getScore(),s.getStatus()===t.STATUS.lose?r.classList.remove("hidden"):s.getStatus()===t.STATUS.win&&h.classList.remove("hidden"),s.checkMovesAvailable()}i.addEventListener("click",function(){s.status===t.STATUS.idle?(s.start(),i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart",a.classList.add("hidden")):(s.restart(),l.textContent=s.getScore(),i.classList.remove("restart"),i.classList.add("start"),i.textContent="Start",a.classList.remove("hidden")),r.classList.add("hidden"),h.classList.add("hidden"),document.addEventListener("keydown",n),s.status!==t.STATUS.playing&&document.removeEventListener("keydown",n)});
//# sourceMappingURL=index.813064a7.js.map
